<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Just a Moment</title>

<meta http-equiv="Cache-Control" content="no-store">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  color:white;
  font-family:system-ui,sans-serif;
}

/* ===== ×¨×§×¢ ××ª×—×œ×£ â€“ CSS ×‘×œ×‘×“ ===== */
body{
  background-size:cover;
  background-position:center;
  animation:bgSlide 66s infinite;
}

@keyframes bgSlide{
  0%   { background-image:url('./bg1.png'); }
  9%   { background-image:url('./bg2.png'); }
  18%  { background-image:url('./bg3.png'); }
  27%  { background-image:url('./bg4.png'); }
  36%  { background-image:url('./bg5.png'); }
  45%  { background-image:url('./bg6.png'); }
  54%  { background-image:url('./bg7.png'); }
  63%  { background-image:url('./bg8.png'); }
  72%  { background-image:url('./bg9.png'); }
  81%  { background-image:url('./bg10.png'); }
  90%  { background-image:url('./bg11.png'); }
  100% { background-image:url('./bg1.png'); }
}

/* ×©×›×‘×ª ×›×”×•×ª ×¢×“×™× ×” */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.22);
  z-index:0;
}

/* ××¤×œ×™×§×¦×™×” */
#app{
  position:relative;
  z-index:1;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:24px;
}

.text{font-size:22px;margin-bottom:14px;}
.timer{font-size:44px;margin-bottom:16px;}

.buttons{
  width:100%;
  max-width:420px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

button,a,input{
  display:block;
  padding:14px;
  font-size:16px;
  border:none;
  border-radius:14px;
  background:#374151;
  color:white;
  text-decoration:none;
  text-align:center;
}

input{background:#1f2933;}

.primary{background:#2563eb;}
.info{background:#065f46;}

.start-btn{
  width:260px;
  margin-top:20px;
}
</style>
</head>

<body>

<div id="overlay"></div>

<div id="app">
  <div class="text">×× ×‘× ×œ×š ×¡×™×’×¨×™×” â€” ×‘×•× × ×©×”×” ×¨×’×¢.</div>
  <button class="primary start-btn" onclick="start()">×”×ª×—×œ</button>
</div>

<audio id="audio" preload="auto">
  <source src="./ambient_brown_ok.wav" type="audio/wav">
</audio>

<script>
// × ×˜×¨×•×œ Service Worker ×œ×“×£ ×”×–×”
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations()
    .then(r => r.forEach(reg => reg.unregister()));
}

/* ===== × ×ª×•× ×™× ===== */
const texts=[
  "××™×Ÿ ×¦×•×¨×š ×œ××”×¨.",
  "×¢×•×“ ×¨×’×¢ ×©×œ ×©×§×˜.",
  "×”×“×—×£ ×™×“×¢ ×œ×”×™×¨×’×¢.",
  "××¤×©×¨ ×¤×©×•×˜ ×œ×”×™×•×ª ×›××Ÿ.",
  "×–×” ×™×¢×‘×•×¨ ×’× ×‘×œ×™ ×¤×¢×•×œ×”."
];

let currentText="";
let remaining=3600;   // 60 ×“×§×•×ª
let timer=null;
let startTime=null;

const app=document.getElementById("app");
const audio=document.getElementById("audio");

/* ===== ×¤×•× ×§×¦×™×•×ª ===== */
function randomText(){
  let t;
  do{
    t=texts[Math.floor(Math.random()*texts.length)];
  }while(t===currentText);
  currentText=t;
  return t;
}

function start(){
  if(timer) return;
  startTime = Date.now();

  audio.volume=0.6;
  audio.play().catch(()=>{});

  render(true);
  timer=setInterval(()=>{
    remaining--;
    if(remaining<=0) clearInterval(timer);
    render(false);
  },1000);
}

function calcSavings(){
  const cigs = Number(document.getElementById("cigsPerDay").value);
  const price = Number(document.getElementById("packPrice").value);
  const result = document.getElementById("result");

  if(!cigs || !price || !startTime){
    result.innerText = "× × ×œ×”×–×™×Ÿ × ×ª×•× ×™× ×•×œ×”×ª×—×™×œ.";
    return;
  }

  const minutesPassed = (Date.now() - startTime) / 60000;
  const avoidedCigs = Math.floor(minutesPassed * (cigs / 1440));
  const savedMoney = (avoidedCigs * (price / 20)).toFixed(2);

  result.innerText =
    `ğŸš­ ${avoidedCigs} ×¡×™×’×¨×™×•×ª | ğŸ’° â‚ª${savedMoney} × ×—×¡×›×•`;
}

function render(changeText){
  const m=String(Math.floor(remaining/60)).padStart(2,"0");
  const s=String(remaining%60).padStart(2,"0");
  const txt=changeText?randomText():currentText;

  app.innerHTML=`
    <div class="text">${txt}</div>
    <div class="timer">${m}:${s}</div>

    <div class="buttons">
      <button onclick="render(true)">×“×œ×’</button>

      <input id="cigsPerDay" type="number" placeholder="×¡×™×’×¨×™×•×ª ×‘×™×•×">
      <input id="packPrice" type="number" placeholder="××—×™×¨ ×—×¤×™×¡×” (â‚ª)">
      <button onclick="calcSavings()">×—×©×‘ ×—×™×¡×›×•×Ÿ</button>
      <div id="result" class="text"></div>

      <a class="info"
         href="https://he.wikipedia.org/wiki/×”×¤×¡×§×ª_×¢×™×©×•×Ÿ"
         target="_blank" rel="noopener">
         ×¢×–×¨×” ×œ×”×¤×¡×§×ª ×¢×™×©×•×Ÿ
      </a>

      <a
         href="https://www.youtube.com/watch?v=gukm--w36PI"
         target="_blank" rel="noopener">
         ×•×™×“××• â€“ ×”×ª××•×“×“×•×ª ×¢× ×“×—×£
      </a>
    </div>
  `;
}
</script>

</body>
</html>
